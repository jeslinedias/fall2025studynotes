<!-- Chosen Palette: Cool Gray Neutrals with Indigo Accent -->
<!-- Application Structure Plan: A single-page application with a sticky top navigation for easy access to distinct thematic sections: 'Fundamentals', 'Liability Types', 'Bonds Deep Dive', and an 'Interactive Calculator'. This structure was chosen over a linear document to allow users to either follow a logical learning path or jump directly to topics of interest. The flow progresses from foundational concepts to specific examples, culminating in an interactive calculator. This tool allows users to apply the learned principles, transforming passive reading into an an active, hands-on learning experience that reinforces understanding of bond amortization. The new IRR section is a static content block that adds a related valuation concept to the Bonds section, complementing the existing bond price calculator without adding new interactive elements. -->
<!-- Visualization & Content Choices: Report Info -> Liability Types. Goal -> Organize. Method -> Interactive Tabs. Interaction -> Click to show/hide content. Justification -> Breaks down content into manageable parts, preventing cognitive overload. | Report Info -> Bond Amortization Table. Goal -> Show Change Over Time. Method -> Interactive Line Chart (Chart.js) and a dynamic HTML table. Interaction -> User inputs bond parameters (face value, rates, years) and clicks a button to generate both the table and a visual chart of the book value's amortization. Justification -> This is the core interactive element. It makes the abstract concept of amortization tangible and demonstrates the direct impact of market rates on interest expense and book value, which is a key learning objective. | Report Info -> IRR. Goal -> Define & exemplify. Method -> Text, formula, and table. Interaction -> Static display. Justification -> Provides a foundational investment metric related to time value of money, enriching the 'Bonds' section with a core concept of financial analysis. -->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Financial Liabilities</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
        }
        .tab-button.active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        /* Style for highlighted search results */
        .highlight {
            background-color: #fde047;
            padding: 2px 4px;
            border-radius: 4px;
        }
        /* Style for custom message box */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 40;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="container mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <a href="FA-landing.html" class="text-xl font-bold text-gray-800 hover:text-indigo-600 transition-colors">Home</a>
            <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-8">
                <div class="hidden md:flex space-x-8">
                    <a href="#fundamentals" class="nav-link text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600">Fundamentals</a>
                    <a href="#liability-types" class="nav-link text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600">Liability Types</a>
                    <a href="#bonds" class="nav-link text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600">Bonds Deep Dive</a>
                    <a href="#calculator" class="nav-link text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600">Calculator</a>
                    <a href="#collections" class="nav-link text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600">Collections</a>
                </div>
                <!-- Search bar and result count -->
                <div class="flex items-center space-x-2">
                    <input type="text" id="searchInput" placeholder="Search..." class="w-full md:w-auto px-3 py-1 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <span id="searchCount" class="text-gray-500 text-sm hidden md:block"></span>
                </div>
            </div>
        </nav>
    </header>

    <main id="mainContent" class="container mx-auto px-6 py-12">

        <section id="fundamentals" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Liability Fundamentals</h2>
            <p class="text-lg text-gray-600 mb-6">This section covers the essential criteria for recognizing a liability in financial statements. Understanding these core principles is the first step to mastering accounting for liabilities.</p>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Recognition Criteria</h3>
                <p class="text-gray-600 mb-6">A liability represents a probable future sacrifice of economic benefits due to a present obligation from a past event. For an obligation to be officially recorded as a liability, it must meet two key conditions:</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-indigo-50 p-6 rounded-lg border border-indigo-200">
                        <h4 class="font-semibold text-indigo-800 text-lg mb-2">1. Existing Debt or Obligation</h4>
                        <p class="text-indigo-700">The duty to act or pay already exists. This obligation is a result of a transaction or event that has already happened, such as receiving goods from a supplier or services from an employee.</p>
                    </div>
                    <div class="bg-indigo-50 p-6 rounded-lg border border-indigo-200">
                        <h4 class="font-semibold text-indigo-800 text-lg mb-2">2. Probable Future Sacrifice</h4>
                        <p class="text-indigo-700">It is likely that the company will have to give up economic resources (like cash or services) in the future to settle the obligation. The outflow of resources is expected.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="liability-types" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Types of Liabilities</h2>
            <p class="text-lg text-gray-600 mb-6">Liabilities are categorized based on their settlement date. This section provides an interactive overview of short-term, long-term, and contingent liabilities, with clear examples for each category.</p>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <div class="mb-6 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" id="tabs">
                        <button class="tab-button active py-4 px-1 inline-flex items-center text-lg font-medium border-b-2 text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="short-term">Short-Term</button>
                        <button class="tab-button py-4 px-1 inline-flex items-center text-lg font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300" data-target="long-term">Long-Term</button>
                        <button class="tab-button py-4 px-1 inline-flex items-center text-lg font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300" data-target="contingent">Contingent</button>
                    </nav>
                </div>
                <div id="tab-content">
                    <div id="short-term" class="tab-pane">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-4">Short-Term (Current) Liabilities</h3>
                        <p class="text-gray-600 mb-4">These are obligations expected to be settled within one year or the company's operating cycle, whichever is longer.</p>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>Accounts Payable:</strong> Money owed to suppliers for goods or services.</li>
                            <li><strong>Wages Payable:</strong> Salaries earned by employees but not yet paid.</li>
                            <li><strong>Unearned Revenue:</strong> Payments received from customers for services or goods that have not yet been delivered. This is a liability because the company owes a service or product.</li>
                        </ul>
                        <div class="mt-6 bg-gray-50 p-4 rounded-md border">
                            <p class="font-semibold text-gray-800">Example: Unearned Revenue</p>
                            <p class="text-gray-600 mt-2">A company receives $100 for a service to be delivered next month. The journal entry is:</p>
                            <pre class="bg-gray-100 p-3 rounded-md mt-2 text-sm"><code>Debit: Cash  $100<br>Credit: Unearned Revenue  $100</code></pre>
                        </div>
                    </div>
                    <div id="long-term" class="tab-pane hidden">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-4">Long-Term Liabilities</h3>
                        <p class="text-gray-600 mb-4">These obligations are due to be settled in a period longer than one year or the operating cycle.</p>
                         <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>Bonds Payable:</strong> A form of long-term debt where a company borrows money from the public and promises to repay it with interest over time.</li>
                            <li><strong>Lease Liabilities:</strong> Obligations to make payments for the right to use an asset (like property or equipment) for an extended period.</li>
                        </ul>
                    </div>
                    <div id="contingent" class="tab-pane hidden">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-4">Contingent Liabilities</h3>
                        <p class="text-gray-600 mb-4">A contingent liability is a potential obligation that may arise depending on the outcome of a future uncertain event. Their accounting treatment is based on the likelihood of the event and whether the amount can be estimated.</p>
                        <div class="space-y-6">
                            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                <h4 class="font-semibold text-blue-800 text-lg mb-2">1. Probable and Estimable</h4>
                                <p class="text-blue-700 mb-2">The future event is likely to occur, and the amount of the loss can be reasonably estimated.</p>
                                <p class="font-bold text-blue-800">Action: Record as a liability and an expense.</p>
                                <p class="text-sm text-blue-600 mt-2">Example: A company is highly likely to lose a lawsuit for a known, estimated amount.</p>
                            </div>
                            <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                <h4 class="font-semibold text-yellow-800 text-lg mb-2">2. Reasonably Possible</h4>
                                <p class="text-yellow-700 mb-2">The chance of the future event occurring is more than remote but less than probable.</p>
                                <p class="font-bold text-yellow-800">Action: Disclose in the notes to the financial statements.</p>
                                <p class="text-sm text-yellow-600 mt-2">Example: A company faces a lawsuit, but the outcome is not certain enough to be considered probable.</p>
                            </div>
                            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                <h4 class="font-semibold text-gray-800 text-lg mb-2">3. Remote</h4>
                                <p class="text-gray-700 mb-2">The chance of the future event occurring is slight.</p>
                                <p class="font-bold text-gray-800">Action: No action required.</p>
                                <p class="text-sm text-gray-600 mt-2">Example: A company is sued, but its lawyers believe there is a very low chance of a judgment against them.</p>
                            </div>
                        </div>
                        <div class="mt-8 space-y-8">
                            <div>
                                <h4 class="text-xl font-semibold text-gray-700 mb-2">Example: Lawsuit Liability</h4>
                                <p class="text-gray-600 mb-4">A company is involved in a lawsuit, and their legal counsel believes a loss of $100,000 is probable and can be reasonably estimated.</p>
                                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                    <p class="font-semibold text-gray-800 mb-2">Transaction Worksheet:</p>
                                    <table class="w-full text-left table-auto">
                                        <thead>
                                            <tr>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Account</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Assets</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Liabilities</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Shareholder Equity</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-t border-gray-300">
                                                <td class="py-2 text-gray-700">Litigation Expense</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right font-semibold text-red-600">($100,000)</td>
                                            </tr>
                                            <tr>
                                                <td class="py-2 text-gray-700">Litigation Liability</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right font-semibold text-green-600">$100,000</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-xl font-semibold text-gray-700 mb-2">Example: Warranty Liability</h4>
                                <p class="text-gray-600 mb-4">A company estimates that 2% of its $500,000 in product sales will be returned for warranty repairs, based on historical data. They record the estimated warranty expense at the time of sale.</p>
                                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                    <p class="font-semibold text-gray-800 mb-2">Transaction Worksheet:</p>
                                    <table class="w-full text-left table-auto">
                                        <thead>
                                            <tr>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Account</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Assets</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Liabilities</th>
                                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Shareholder Equity</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-t border-gray-300">
                                                <td class="py-2 text-gray-700">Warranty Expense</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right font-semibold text-red-600">($10,000)</td>
                                            </tr>
                                            <tr>
                                                <td class="py-2 text-gray-700">Warranty Liability</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                                <td class="py-2 text-gray-700 text-right font-semibold text-green-600">$10,000</td>
                                                <td class="py-2 text-gray-700 text-right"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="bonds" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Bonds Deep Dive</h2>
            <p class="text-lg text-gray-600 mb-6">Explore the complexities of bonds, a common form of long-term financing. This section covers bond pricing, the crucial concept of the Time Value of Money, and the effective interest method for amortization.</p>
            <div class="space-y-8">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="2xl font-semibold text-gray-700 mb-4">Bond Pricing: Stated Rate vs. Market Rate</h3>
                    <p class="text-gray-600 mb-6">A bond's selling price depends on the relationship between its stated interest rate (coupon rate) and the market interest rate for similar bonds at the time of issuance.</p>
                    <div class="grid md:grid-cols-3 gap-4 text-center">
                        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-800">Premium</h4>
                            <p class="text-sm text-green-700">Stated Rate > Market Rate</p>
                            <p class="text-xs text-gray-600 mt-1">Sells for more than face value.</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800">Discount</h4>
                            <p class="text-sm text-red-700">Stated Rate < Market Rate</p>
                            <p class="text-xs text-gray-600 mt-1">Sells for less than face value.</p>
                        </div>
                        <div class="p-4 bg-gray-100 rounded-lg border border-gray-200">
                            <h4 class="font-bold text-gray-800">Par Value</h4>
                            <p class="text-sm text-gray-700">Stated Rate = Market Rate</p>
                             <p class="text-xs text-gray-600 mt-1">Sells for its exact face value.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Time Value of Money (TVM) in Bond Valuation</h3>
                    <p class="text-gray-600 mb-6">A bond's price is the present value of its future cash flows, which consist of periodic interest payments (an annuity) and the repayment of the principal at maturity (a lump sum). The formulas below are used to calculate these present values.</p>
                    <div class="space-y-4">
                        <div>
                            <p class="font-medium text-gray-700">PV of Face Value (Lump Sum):</p>
                            <pre class="bg-gray-100 p-3 rounded-md mt-1 text-sm"><code>PV = FV / (1 + r)^n</code></pre>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">PV of Interest Payments (Annuity):</p>
                            <pre class="bg-gray-100 p-3 rounded-md mt-1 text-sm"><code>PV = PMT * [1 - (1 + r)^-n] / r</code></pre>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Total Bond Price:</p>
                            <pre class="bg-indigo-100 text-indigo-800 font-bold p-3 rounded-md mt-1 text-sm"><code>Bond Price = PV(Annuity) + PV(Face Value)</code></pre>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Internal Rate of Return (IRR)</h3>
                    <p class="text-gray-600 mb-6">The <strong>Internal Rate of Return (IRR)</strong> is a financial metric used to estimate the profitability of potential investments. It is the discount rate that makes the <strong>Net Present Value (NPV)</strong> of all cash flows from a particular project equal to zero. In other words, it is the rate of return that an investment is expected to generate.</p>
                    <div class="space-y-4">
                        <div>
                            <p class="font-medium text-gray-700">IRR Formula:</p>
                            <pre class="bg-gray-100 p-3 rounded-md mt-1 text-sm"><code>NPV = C_0/(1+IRR)^0 + C_1/(1+IRR)^1 + ... + C_T/(1+IRR)^T = 0</code></pre>
                            <p class="text-gray-600 mt-2 text-sm">Where C_t is the net cash inflow/outflow during period t, and T is the total number of periods.</p>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Example:</p>
                            <p class="text-gray-600 mb-2">Consider an investment with an initial cost of <strong>$1,000</strong> that generates annual cash flows of <strong>$400, $400, and $400</strong> over three years. The IRR is the rate that makes the present value of the inflows equal to the initial investment.</p>
                            <table class="min-w-full divide-y divide-gray-200 mt-4">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cash Flow ($)</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr><td class="px-6 py-4 whitespace-nowrap">0 (Initial)</td><td class="px-6 py-4 whitespace-nowrap font-bold text-red-600">-$1,000</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">1</td><td class="px-6 py-4 whitespace-nowrap">$400</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">2</td><td class="px-6 py-4 whitespace-nowrap">$400</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">3</td><td class="px-6 py-4 whitespace-nowrap">$400</td></tr>
                                </tbody>
                            </table>
                            <p class="text-gray-600 mt-4 text-sm">In this example, the IRR is approximately <strong>9.7%</strong> as it is the rate that solves the equation:
                            <pre class="bg-gray-100 p-3 rounded-md mt-2 text-sm"><code>-1,000 + 400/(1.097)^1 + 400/(1.097)^2 + 400/(1.097)^3 = ~0</code></pre>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="calculator" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Bond Amortization Calculator</h2>
            <p class="text-lg text-gray-600 mb-6">Use this interactive tool to visualize how a bond's book value is amortized over time. Enter the bond's details to generate a detailed table and a chart of its value change.</p>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label for="faceValue" class="block text-sm font-medium text-gray-700">Face Value ($)</label>
                        <input type="number" id="faceValue" value="1000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="statedRate" class="block text-sm font-medium text-gray-700">Stated Interest Rate (%)</label>
                        <input type="number" id="statedRate" value="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="marketRate" class="block text-sm font-medium text-gray-700">Market Interest Rate (%)</label>
                        <input type="number" id="marketRate" value="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="years" class="block text-sm font-medium text-gray-700">Years to Maturity</label>
                        <input type="number" id="years" value="5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                </div>
                <div class="flex justify-center mb-8">
                    <button id="calculateBtn" class="px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">Calculate Amortization</button>
                </div>

                <div id="results" class="hidden">
                    <div id="summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center bg-gray-50 p-6 rounded-lg shadow-inner"></div>

                    <h3 class="text-2xl font-semibold text-gray-700 mb-4">Amortization Schedule</h3>
                    <div class="overflow-x-auto shadow-md rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cash Interest Paid</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Interest Expense</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amortization</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Book Value</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationTable" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="chart-container mt-8">
                        <canvas id="amortizationChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="collections" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">The Collections Cycle</h2>
            <p class="text-lg text-gray-600 mb-6">This section explains how companies account for potential uncollectible accounts using the allowance method, ensuring assets are not overstated.</p>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Example: Allowance for Uncollectible Accounts</h3>
                <p class="text-gray-600 mb-4">A company has $100,000 in accounts receivable. Based on past experience, they estimate that $5,000 will be uncollectible. The accounts are deemed uncollectible at the time of the sale.</p>
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <p class="font-semibold text-gray-800 mb-2">Transaction Worksheet:</p>
                    <table class="w-full text-left table-auto">
                        <thead>
                            <tr>
                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Account</th>
                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Assets</th>
                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Liabilities</th>
                                <th class="py-2 text-sm font-medium text-gray-500 w-1/4">Shareholder Equity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-t border-gray-300">
                                <td class="py-2 text-gray-700">Bad Debt Expense</td>
                                <td class="py-2 text-gray-700 text-right"></td>
                                <td class="py-2 text-gray-700 text-right"></td>
                                <td class="py-2 text-gray-700 text-right font-semibold text-red-600">($5,000)</td>
                            </tr>
                            <tr>
                                <td class="py-2 text-gray-700">Allowance for Doubtful Accounts</td>
                                <td class="py-2 text-gray-700 text-right font-semibold text-red-600">($5,000)</td>
                                <td class="py-2 text-gray-700 text-right"></td>
                                <td class="py-2 text-gray-700 text-right"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- Custom message box for alerts -->
    <div id="messageBox" class="hidden message-box-overlay">
        <div class="message-box">
            <p id="messageText" class="text-center font-medium text-gray-800 mb-4"></p>
            <button id="closeMessageBtn" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tab-button');
            const tabPanes = document.querySelectorAll('.tab-pane');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBtn = document.getElementById('closeMessageBtn');

            // Function to show custom message box
            const showMessage = (message) => {
                messageText.textContent = message;
                messageBox.classList.remove('hidden');
            };

            // Function to hide custom message box
            closeMessageBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const target = tab.getAttribute('data-target');

                    tabPanes.forEach(pane => {
                        if (pane.id === target) {
                            pane.classList.remove('hidden');
                        } else {
                            pane.classList.add('hidden');
                        }
                    });
                });
            });

            const calculateBtn = document.getElementById('calculateBtn');
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary');
            const tableBody = document.getElementById('amortizationTable');
            const chartCanvas = document.getElementById('amortizationChart');
            let amortizationChart = null;

            calculateBtn.addEventListener('click', () => {
                const faceValue = parseFloat(document.getElementById('faceValue').value);
                const statedRate = parseFloat(document.getElementById('statedRate').value) / 100;
                const marketRate = parseFloat(document.getElementById('marketRate').value) / 100;
                const years = parseInt(document.getElementById('years').value);

                if (isNaN(faceValue) || isNaN(statedRate) || isNaN(marketRate) || isNaN(years) || years <= 0) {
                    showMessage('Please enter valid inputs.');
                    return;
                }

                resultsDiv.classList.remove('hidden');
                tableBody.innerHTML = '';

                const pmt = faceValue * statedRate;
                const pvAnnuity = pmt * ( (1 - Math.pow(1 + marketRate, -years)) / marketRate );
                const pvFaceValue = faceValue / Math.pow(1 + marketRate, years);
                let bookValue = pvAnnuity + pvFaceValue;
                
                const bondType = bookValue > faceValue ? 'Premium' : (bookValue < faceValue ? 'Discount' : 'Par');
                
                summaryDiv.innerHTML = `
                    <div><p class="text-sm text-gray-500">Bond Price</p><p class="text-lg font-bold text-gray-800">$${bookValue.toFixed(2)}</p></div>
                    <div><p class="text-sm text-gray-500">Bond Type</p><p class="text-lg font-bold ${bondType === 'Premium' ? 'text-green-600' : (bondType === 'Discount' ? 'text-red-600' : 'text-gray-800')}">${bondType}</p></div>
                    <div><p class="text-sm text-gray-500">Total Interest</p><p class="text-lg font-bold text-gray-800">$${(pmt * years).toFixed(2)}</p></div>
                    <div><p class="text-sm text-gray-500">Total Expense</p><p class="text-lg font-bold text-gray-800">$${((pmt * years) - (bookValue-faceValue)).toFixed(2)}</p></div>
                `;

                let initialRow = `<tr>
                    <td class="px-6 py-4 whitespace-nowrap font-bold">0</td>
                    <td class="px-6 py-4 whitespace-nowrap">-</td>
                    <td class="px-6 py-4 whitespace-nowrap">-</td>
                    <td class="px-6 py-4 whitespace-nowrap">-</td>
                    <td class="px-6 py-4 whitespace-nowrap font-bold">$${bookValue.toFixed(2)}</td>
                </tr>`;
                tableBody.innerHTML += initialRow;

                const chartLabels = ['Year 0'];
                const chartData = [bookValue];

                for (let i = 1; i <= years; i++) {
                    const interestExpense = bookValue * marketRate;
                    const amortization = pmt - interestExpense;
                    bookValue -= amortization;
                    
                    if (i === years) { 
                        bookValue = faceValue;
                    }

                    let row = `<tr>
                        <td class="px-6 py-4 whitespace-nowrap">${i}</td>
                        <td class="px-6 py-4 whitespace-nowrap">$${pmt.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">$${interestExpense.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">$${amortization.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">$${bookValue.toFixed(2)}</td>
                    </tr>`;
                    tableBody.innerHTML += row;

                    chartLabels.push(`Year ${i}`);
                    chartData.push(bookValue);
                }

                if (amortizationChart) {
                    amortizationChart.destroy();
                }

                amortizationChart = new Chart(chartCanvas, {
                    type: 'line',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'Book Value of Bond',
                            data: chartData,
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Book Value ($)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return ` Book Value: $${context.parsed.y.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            const mainContent = document.getElementById('mainContent');
            const searchCount = document.getElementById('searchCount');

            // Store original text content of nodes to revert later
            const originalNodeContent = new Map();

            const highlightText = () => {
                const query = searchInput.value.trim();

                // First, remove all previous highlights and restore original text
                const highlightedSpans = mainContent.querySelectorAll('span.highlight');
                highlightedSpans.forEach(span => {
                    const parent = span.parentNode;
                    // Restore original content from the stored map
                    if (originalNodeContent.has(span)) {
                        parent.replaceChild(document.createTextNode(originalNodeContent.get(span)), span);
                    } else {
                        // If for some reason the map doesn't have it, just unwrap the span
                        parent.replaceChild(document.createTextNode(span.textContent), span);
                    }
                });
                originalNodeContent.clear();

                if (query === '') {
                    searchCount.textContent = '';
                    searchCount.classList.add('hidden');
                    return;
                }

                const regex = new RegExp(`(${query})`, 'gi');
                let matchCount = 0;
                
                const walk = document.createTreeWalker(mainContent, NodeFilter.SHOW_TEXT, null, false);
                let node;
                const nodesToReplace = [];

                while (node = walk.nextNode()) {
                    if (node.parentNode.tagName !== 'SCRIPT' && node.textContent.trim() !== '' && regex.test(node.textContent)) {
                        nodesToReplace.push(node);
                    }
                }

                nodesToReplace.forEach(node => {
                    const parent = node.parentNode;
                    const text = node.textContent;
                    const fragment = document.createDocumentFragment();
                    let lastIndex = 0;
                    
                    text.replace(regex, (match, p1, offset) => {
                        fragment.appendChild(document.createTextNode(text.substring(lastIndex, offset)));
                        
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        span.textContent = match;
                        fragment.appendChild(span);
                        
                        lastIndex = offset + match.length;
                        matchCount++;
                        originalNodeContent.set(span, match); // Store the original text for this highlight
                    });
                    
                    if (lastIndex < text.length) {
                        fragment.appendChild(document.createTextNode(text.substring(lastIndex)));
                    }
                    
                    parent.replaceChild(fragment, node);
                });

                searchCount.textContent = `${matchCount} matches`;
                searchCount.classList.remove('hidden');
            };

            searchInput.addEventListener('input', highlightText);
        });
    </script>
</body>
</html>
